<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../oc-core-utils/oc-core-utils.html">

<dom-module id="oc-transactions-api">
	<template>
		<iron-ajax id="accountTransfer"></iron-ajax>
		<iron-ajax id="createFlashTopUp"></iron-ajax>
		<iron-ajax id="executeTopup"></iron-ajax>
	</template>

	<script>
		/**
		 * `oc-transactions-api`
		 * Api endpoint for all transaction related queries
		 *
		 * @customElement
		 * @polymer
		 * @demo demo/index.html
		 */
		class OcTransactionsApi extends Ordercloud.ApiMixin(Polymer.Element) {
			static get is() {
				return 'oc-transactions-api';
			}

			static get properties() {
				return {}
			};

			/**
			 * Transfer between accounts
			 * @param amount
			 * @param fromAccountId
			 * @param toAccountId
			 * @returns {*}
			 */
			accountTransfer(amount, fromAccountId, toAccountId, details) {
				this.$.accountTransfer.url = this._generateUrl('transactions/transfer');
				this.$.accountTransfer.method = "POST";
				this.$.accountTransfer.contentType = "application/json";
				this.$.accountTransfer.body = {
					amount: amount,
					fromAccountId: fromAccountId,
					toAccountId: toAccountId,
					...details
				};
				return this._generateRequest(this.$.accountTransfer);
			}

			createFlashTopUp(amount, fromOrgId, transaction, transactionType, topUpReference) {
				this.$.createFlashTopUp.url = this._generateUrl('v2/transactions');
				this.$.createFlashTopUp.method = "POST";
				this.$.createFlashTopUp.contentType = "application/json";
				this.$.createFlashTopUp.body = {
					transactingOrgId: fromOrgId,
					txnType: transactionType,
					transactorReference:topUpReference,
					from:{
						account:{amount: amount}
					},
					to:transaction
				};
				return this._generateRequest(this.$.createFlashTopUp);
			}
			executeTopup(fromOrgId, transactionId) {
				this.$.executeTopup.url = this._generateUrl('v2/transactions/start');
				this.$.executeTopup.method = "PUT";
				this.$.executeTopup.contentType = "application/json";
				this.$.executeTopup.body = {
					transactingOrgId: fromOrgId,
					txnId: transactionId,
				};
				return this._generateRequest(this.$.executeTopup);
			}
		}

		window.customElements.define(OcTransactionsApi.is, OcTransactionsApi);
	</script>
</dom-module>
